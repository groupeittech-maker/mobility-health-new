<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Financi√®re - Mobility Health</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .filters {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .btn {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-secondary {
            background: #95a5a6;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .movements-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #34495e;
            color: white;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-credit {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-debit {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-payment {
            background: #cce5ff;
            color: #004085;
        }
        
        .badge-refund {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-repartition {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .amount {
            font-weight: 600;
        }
        
        .amount-positive {
            color: #27ae60;
        }
        
        .amount-negative {
            color: #e74c3c;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #f8f9fa;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Gestion Financi√®re</h1>
            <p>Journal des mouvements financiers</p>
        </div>
        
        <div class="stats" id="stats">
            <!-- Stats will be loaded here -->
        </div>
        
        <div class="filters">
            <div class="filters-grid">
                <div class="filter-group">
                    <label>Compte</label>
                    <select id="accountFilter">
                        <option value="">Tous les comptes</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Type de mouvement</label>
                    <select id="typeFilter">
                        <option value="">Tous les types</option>
                        <option value="credit">Cr√©dit</option>
                        <option value="debit">D√©bit</option>
                        <option value="payment">Paiement</option>
                        <option value="refund">Remboursement</option>
                        <option value="repartition">R√©partition</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Date d√©but</label>
                    <input type="date" id="dateStart">
                </div>
                <div class="filter-group">
                    <label>Date fin</label>
                    <input type="date" id="dateEnd">
                </div>
                <div class="filter-group" style="justify-content: flex-end;">
                    <button class="btn" onclick="loadMovements()">Filtrer</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">R√©initialiser</button>
                </div>
            </div>
        </div>
        
        <div id="errorMessage" class="error" style="display: none;"></div>
        
        <div class="movements-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Compte</th>
                        <th>Montant</th>
                        <th>Description</th>
                        <th>R√©f√©rence</th>
                    </tr>
                </thead>
                <tbody id="movementsBody">
                    <tr>
                        <td colspan="7" class="loading">Chargement...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="pagination">
            <button id="prevBtn" onclick="previousPage()" disabled>Pr√©c√©dent</button>
            <span id="pageInfo">Page 1</span>
            <button id="nextBtn" onclick="nextPage()">Suivant</button>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let currentPage = 0;
        let pageSize = 50;
        let token = localStorage.getItem('token') || '';
        
        // Load movements on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadAccounts();
            loadMovements();
        });
        
        async function loadAccounts() {
            try {
                // In a real app, you'd fetch accounts from API
                const accounts = [
                    { id: 1, account_number: 'ACC-001', account_name: 'Compte Principal' },
                    { id: 2, account_number: 'ACC-002', account_name: 'Compte Clients' },
                    { id: 3, account_number: 'ACC-003', account_name: 'Compte Fournisseurs' }
                ];
                
                const select = document.getElementById('accountFilter');
                accounts.forEach(acc => {
                    const option = document.createElement('option');
                    option.value = acc.id;
                    option.textContent = `${acc.account_number} - ${acc.account_name}`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading accounts:', error);
            }
        }
        
        async function loadMovements() {
            const accountId = document.getElementById('accountFilter').value;
            const movementType = document.getElementById('typeFilter').value;
            
            const params = new URLSearchParams({
                skip: currentPage * pageSize,
                limit: pageSize
            });
            
            if (accountId) params.append('account_id', accountId);
            if (movementType) params.append('movement_type', movementType);
            
            try {
                const response = await fetch(`${API_BASE}/finance/movements?${params}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load movements');
                }
                
                const movements = await response.json();
                displayMovements(movements);
                updatePagination(movements.length === pageSize);
            } catch (error) {
                showError('Erreur lors du chargement des mouvements: ' + error.message);
            }
        }
        
        function displayMovements(movements) {
            const tbody = document.getElementById('movementsBody');
            
            if (movements.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="loading">Aucun mouvement trouv√©</td></tr>';
                return;
            }
            
            tbody.innerHTML = movements.map(m => `
                <tr>
                    <td>${m.id}</td>
                    <td>${new Date(m.created_at).toLocaleDateString('fr-FR')}</td>
                    <td><span class="badge badge-${m.movement_type}">${m.movement_type}</span></td>
                    <td>${m.account_id}</td>
                    <td class="amount ${m.movement_type === 'credit' || m.movement_type === 'payment' || m.movement_type === 'refund' ? 'amount-positive' : 'amount-negative'}">
                        ${m.movement_type === 'credit' || m.movement_type === 'payment' || m.movement_type === 'refund' ? '+' : '-'}${parseFloat(m.amount).toFixed(2)} ‚Ç¨
                    </td>
                    <td>${m.description || '-'}</td>
                    <td>${m.reference || '-'}</td>
                </tr>
            `).join('');
        }
        
        function updatePagination(hasNext) {
            document.getElementById('prevBtn').disabled = currentPage === 0;
            document.getElementById('nextBtn').disabled = !hasNext;
            document.getElementById('pageInfo').textContent = `Page ${currentPage + 1}`;
        }
        
        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                loadMovements();
            }
        }
        
        function nextPage() {
            currentPage++;
            loadMovements();
        }
        
        function resetFilters() {
            document.getElementById('accountFilter').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('dateStart').value = '';
            document.getElementById('dateEnd').value = '';
            currentPage = 0;
            loadMovements();
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>




